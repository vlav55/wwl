       Описание API
API WinWinLand позволяет работать с данными платформы, используя HTTP-запросы. При помощи API можно получать, добавлять, изменять и удалять информацию о различных объектах. Функционал API позволяет интегрировать различные внешние сервисы, обеспечить синхронизацию данных, а также получить все данные для создания кастомного партнерского кабинета в  WinWinLand.

       Ограничения
На платформе присутствует ограничение в 500 запросов к API в течение 5 минут.

Время рассчитывается с момента первого запроса в серии. Количество выполненных запросов в текущем промежутке времени передается в HTTP-заголовке API-Usage-Limit (например, API-Usage-Limit: 1/500).

При достижении лимита доступ к API ограничивается до окончания текущих 5 минут. При этом в HTTP-заголовке Retry-After передается время в секундах до восстановления доступа.

       Авторизация
Для авторизации необходимо указать
1. Номер аккаунта (client_id) — зайти в CRM, Настройки-Профиль и раскрыть иконку рядом с заголовком «Профиль». Это число, например 12345
2. Secret (client_secret) — скопировать из Настройки — Профиль - Настройка интеграций по API и вебхук

В каждом запросе вам необходимо передавать в заголовке данные Basic авторизации:
Authorization: Basic  base64_encode("client_id:client_secret")
В случае ошибки авторизации возвращается код 401 и ответ в формате JSON вида ['error' => 'Unauthorized: error description']

       Общие принципы
API WinWinLand принимает POST, GET, PUT и DELETE-запросы в зависимости от выполняемого действия. Тип и адрес запроса для требуемого действия можно найти на api.winwinland.ru.

Текст самого запроса должен соответствовать формату JSON. Значение HTTP-заголовка Content-Type: application/json

Пример GET запроса на PHP на получение информации о лиде/партнере. Запрос находит лида с email :'mail@gmail.com' и выводит информацию о нем.

$client_id='12345';
$client_secret='ec8ce6abb3e952a85b8551ba726a1555';
$data=['client_email'=>'mail@gmail.com'];
$url="https://api.winwinland.ru/lead/";

$ch = curl_init();

// Устанавливаем параметры запроса
$data = http_build_query($data);
curl_setopt($ch, CURLOPT_URL, $url.'?'.$data);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_HTTPHEADER, [
        'Authorization: Basic ' . base64_encode("$client_id:$client_secret") // Кодируем учетные данные в формате Base64
    ]);
// Выполняем запрос
$response = curl_exec($ch);
curl_close($ch);
// Проверяем на ошибки
if ($response === false) {
	echo 'cURL Error: ' . curl_error($ch);
} else {
        // Обрабатываем ответ
	$res = json_decode($response, true);
	print_r($res); // Печатаем полученные данные
}

       Ответы сервера
200 OK — Штатный ответ, указывающий на успешное выполнение запроса.
201 Created — Может возвращаться при создании новых объектов, также означает успешную операцию.
400 Bad Request — Некорректный HTTP-запрос, сервер не смог его обработать (например, слишком большой заголовок).
401 Unauthorized — Ошибка авторизации; необходимо проверить данные для Basic-авторизации приложения.
403 Forbidden — Нет прав для выполнения данной операции; проверьте настройки прав доступа для вашего приложения.
404 Not Found — Запрошенный объект не найден, возможно, его удалили или ID указан ошибочно.
429 Too Many Requests — Превышены лимиты на API-запросы; если лимитов не хватает, стоит обратиться в поддержку.
500 Internal Server Error — Внутренняя ошибка сервераnsales; возможно, проблема в некорректном формировании данных в запросе.
504 Gateway Timeout — Сервер не успел обработать запрос за установленное время (50 секунд); может быть вызвано слишком большим объемом запрашиваемых данных. 
       Вызовы API
Ссылка на раздел с вызовами API

Получение информации о лиде/партнере. 
При запросе происходит поиск лида по одному из параметров (указаны в порядке приоритета поиска). При успешном поиске возвращается массив с данными о лиде/партнере.

Endpoint:	GET /lead/

Parameters:	
client_uid => (numbers only)  ID контакта в CRM WinWinLand, может быть отрицательное значение.
client_phone => (numbers only)  нужно для подстановки в secret. Если не указан client_uid, то производится поиск по номеру телефона. Будет выдан первый найденный контакт с этим номером.
client_email => Если не указан или не был найден контакт ни по client_uid, ни по client_phone, то производится поиск по email. Будет выдан первый найденный контакт с этим email.
client_tg => Поиск по telegram_id
client_vk => Поиск по vkontakte_id
order => (string). — не обязательно. Номер заказа. Если передано, то к результату будут добавлены данные по этому заказу, если он существует и относится к этому контакту

Response: 200, json
Структура данных, возвращаемых при успешном поиске:
Array
(
    [secret] => не используется
    [action] => не используется
    [uid] => Уникальный идентификатор (client_uid) карточки в CRM WinWinLand
    [first_name] => Имя 
    [last_name] => Фамилия 
    [phone] => Номер телефона 
    [email] => Электронная почта 
    [city] => Город 
    [telegram_id] => ID  в Telegram
    [telegram_nic] => Никнейм  в Telegram
    [vk_id] => ID ВКонтакте
    [tm] => Временная метка (timestamp) создания записи
    [comm] => Комментарий в карточке 
    [partner_id] =>  ID вышестоящего партнёра (если 0, значит, пользователь не привязан к партнеру)
    [is_partner] => Флаг, указывающий, что это партнёр
    [partner_code] => Партнёрский код пользователя (если партнер)
    [cabinet_link] => ссылка на партнерский кабинет (если партнер)
    [direct_code] => код для прямого доступа в партнерский кабинет. По этому коду партнер логинится в системе.
    [bank_details] => реквизиты для выплаты вознаграждения, указанные в личном кабинете
    [partner_data] => Array //Массив данных по партнеру (если партнер). Информация та же, что и в партнерском кабинете.
        (
            [cnt_reg_year] => Количество регистраций за год
            [sum_buy_year] => Сумма покупок за год
            [sum_fee_year] => Сумма комиссий за год
            [sum_pay_year] => Сумма выплат за год
            [cnt_reg_this_month] => Регистрации в текущем месяце
            [sum_buy_this_month] => Покупки в текущем месяце
            [sum_fee_this_month] => Комиссии в текущем месяце
            [sum_pay_this_month] => Выплаты в текущем месяце
            [cnt_reg_last_month] => Регистрации в прошлом месяце
            [sum_buy_last_month] => Покупки в прошлом месяце
            [sum_fee_last_month] => Комиссии в прошлом месяце
            [sum_pay_last_month] => Выплаты в прошлом месяце
            [cnt_reg_this_week] => Регистрации на текущей неделе
            [sum_buy_this_week] => Покупки на текущей неделе
            [sum_fee_this_week] => Комиссии на текущей неделе
            [sum_pay_this_week] => Выплаты на текущей неделе
            [cnt_reg_yesterday] => Регистрации за вчера
            [sum_buy_yesterday] => Покупки за вчера
            [sum_fee_yesterday] => Комиссии за вчера
            [sum_pay_yesterday] => Выплаты за вчера
            [cnt_reg_today] => Регистрации за сегодня
            [sum_buy_today] => Покупки за сегодня
            [sum_fee_today] => Комиссии за сегодня
            [sum_pay_today] => Выплаты за сегодня
            [sum_fee_all] => Общая сумма комиссий за всё время
            [sum_pay_all] => Общая сумма выплат за всё время
            [rest_all] => Остаток средств (разница между комиссиями и выплатами)
        )


[current_order] => Array //массив данных по текущему оплаченному заказу (присутствует только, если вебхук был отправлен по событию "Покупка" или "Оплата")
[fee_detailed] =>array //начисления партнеру по операциям
  (
    [client_uid] => uid клиента, по продаже которому начислены комиссионные
    [tm] => время операции (unix timestamp)
    [first_name] => имя клиента
    [last_name] => фамилия клиента
    [order_number] => номер заказа
    [order_descr] => продукт
    [sum] => сумма заказа
    [fee_percent] => вознагр в %
    [fee_sum] => сумма начисленного вознаграждения
    [level] => уровень в партнерской программе (1 - собственная продажа)
    [partner_uid] => uid партнера, по продаже которого было начислено вознаграждение (либо собственная продажа)
    [partner_name] => имя партнера, по продаже которого было начислено вознаграждение (либо собственная продажа)
    [comm] => комментарий к операции, если был указан при ручном начислении
  )
[fee_paid] => Array  //выплаты партнеру по операциям
                (
                    [tm] => время операции, timestamp
                    [sum_pay] => сумма оплаты
                    [vid] => Вид платежа. 1 - деньги, ... 
                    [comm] => комментарий к платежу
                )
[fee_orders] => Array //Заказы от рефералов
              (
  [tm]=> (timestamp) время заказа 
                [referal_uid] => uid реферала
  [referal_name]=>  имя реферала
  [sum]=> сумма заказа
  [paid]=> оплачен заказ или нет (1 или 0)
             )            ];
    (
		[tm] => Временная метка заказа
        [pay_system] => Платёжная система
        [sku] => Артикул товара
        [order_id] => ID заказа
        [order_number] => Номер заказа 
        [client_name] => Имя клиента (указанное при на заполнении платежной формы) 
        [phone] => Телефон клиента (указанное при на заполнении платежной формы) 
        [email] => Почта клиента (указанное при на заполнении платежной формы) 
        [uid] => ID клиента
        [res] => Результат операции (1 — успешно)
        [currency] => Валюта (0 — рубли)
        [land_num] => Номер платежного лендинга
        [comm] => Комментарий к заказу
        [products] => Array //массив продуктов в составе заказа
            (
                [0] => Array
                    (
                        [product_id] => ID товара (соответствует номеру в справочнике продуктов)
                        [product_descr] => Наименование товара
                        [amount] => Стоимость товара
                        [tm_end] => Время окончания доступа (если 0 - то ограничения нет)
                        [fee_1] => Комиссия партнёра уровня 1 (значение заполнено, если при оплате был применен партнерский промокод, данные берутся из промокода. Если значение здесь указано,то данные для расчета комиссии будут браться отсюда, если нет,то будет взято значение из индивидуальных настроек для партнера,если и там нет - то из справочника продуктов.
                        [fee_2] => Комиссия партнёра уровня 2 (алгоритм то же)
                    )

            )

        [sum] => Общая сумма заказа
    )

[promocodes] => Array //массив партнерских промокодов, доступных для использования (должен быть партнером)
    (
        [0] => Array
            (
                [id] => ID промокода
                [tm1] => Начало действия
                [tm2] => Окончание действия
                [uid] => ID владельца промокода
                [product_id] => Номер товара в системе, для которого действует промокод
                [product_descr] => Наименование продукта
                [discount] => Скидка. Если значение <100 , то считается, что это %, 100 и больше - считается в рублях
                [price] => Фиксированная цена (если discount=0) (если обы значения 0 - то промокод дает нулевую цену)
                [promocode] => Сам промокод
                [fee_1] => Комиссия 1-го уровня для владельца (<100 - проценты, 100 и больше - рубли)
                [fee_2] => Комиссия 2-го уровня для владельца
                [cnt] => Ограничение на количество использований (-1 - без ограничений по количеству)
            )
)


--------------


Добавление лида/партнера 
Запрос добавляет лида/партнера в  CRM WinWinLand

Endpoint:	POST /lead/

Parameters:	
bc => (int) партнерский код — не обязательно. Партнерский код вышестоящего партнера, за которым лид будет закреплен.

land_num => (int) номер лэндинга. Несмотря на то, что запрос отправляется из сторонней системы, в Винвинлэнд должен быть создан лэндинг (который не требуется оформлять), но из него будут подтягиваться время события, этап и тэг, если указаны. Также возможно настраивать триггерные рассылки по событиям регистраций на этом лэндинге. Если лэндинг не указан, то используется лэндинг номер 1.

Если client_phone или client_email найден в CRM, то зафиксируется событие регистрации, но новой записи создаваться не будет

client_name => (string) — обязательно. Если лид уже есть в CRM, то имя затронуто не будет.
last_name => (string) — не обязательно. Если лид уже есть в CRM, то изменения будут записаны, только если в существующей записи этот параметр отсутствует.
То же касается и всех не обязательных параметров ниже.

client_phone => (numbers only) — не обязательно

client_email => (string in email format) — не обязательно

telegram_id => (int) — не обязательно

telegram_nic => (string) — не обязательно

vk_id => (int) — не обязательно

city => (string) — не обязательно

comm => (string) — не обязательно — текстовый комментарий

make_partner => 1 или 0 — не обязательно, по умолчанию 0. Сделать партнером. Если лид уже зарегистрирован, как партнер, то ничего не происходит. Если лид уже существует в базе, то он будет сделан партнером.

make_partner_code => (string) — не обязательно, партнерский код для вновь созданного или существующего партнера (в этом случае старый код будет заменен. Учтите, что в этом случае ранее созданные ссылки работать не будут). Работает только при make_partner=1,если make_partner_code не задано или 0 — то создастся автоматически числовой партнерский код.

utm метки (string) вы можете передать также любые стандартные utm метки, они привяжутся к событию регистрации и можно будет видеть в карточке в CRM и в отчетах. Так, например, можно будет отследить оплаты по utm меткам.

Response: 200 при успешном результате, либо 400 и error + описание ошибки.

--------------------

Добавление события оплаты

Запрос добавляет информацию об оплате в CRM WinWinLand вмести с данными о клиенте. Далее  WinWinLand использует информацию о партнере, за которым закреплен клиент, и рассчитывает вознаграждение, на основе сохраненных условий, на всех партнерских уровнях.

Endpoint:	POST /pay/

Parameters:	
bc => (int) партнерский код — не обязательно. Партнерский код вышестоящего партнера, за которым лид будет закреплен, если его нет в базе, либо если он ни за кем не закреплен.

Производится поиск по client_uid, client_email, client_phone (с учетом приоритета, как перечислено). Если клиент найден, то оплата присваивается ему, если нет, то создается новый лид, без партнерского статуса, и к нему привязывается событие оплаты. В случае создания лид прикрепляется к партнеру, которому принадлежит партнесркий код bc.

land_num => (int) номер лэндинга. Несмотря на то, что запрос отправляется из сторонней системы, в Винвинлэнд должен быть создан лэндинг (который не требуется оформлять), но из него будут подтягиваться время события, этап и тэг, если указаны. Также возможно настраивать триггерные рассылки по событиям регистраций на этом лэндинге. Если лэндинг не указан, то используется лэндинг номер 1.

client_name => (string) — Должно быть

client_uid => (string, может быть отрицательным) —  не обязательно

client_phone => (numbers only) — не обязательно

client_email => (string in email format) — не обязательно
Один из трех параметров, перечисленных выше, должен быть обязательно, для идентификации в CRM

sku => (varchar 32) — не обязательно

order_number => (varchar 32) — не пустое значение — номер заказа. Если заказ с таким номером уже существует, то вызов вернет ошибку

product_id => (int) — обязательно. Важно! Предварительно в WinWinLand в справочнике продуктов (Настройки-продукты) должен существовать продукт с таким же номером (ID) .

product_descr => (string) —  обязательно. Название продукта

pay_system => (string) — не обязательно — платежная система, информационно, для отчетов. По умолчанию ‘api’

payed_money => (string) — сумма платежа. Возможен цифровой формат, либо 123 руб и т.п. Будет преобразовано к числу.

payed_at => (unix timestamp) не обязательно —Время платежа. По умолчанию текущее время.

payed_end => (unix timestamp) не обязательно —Время окончания подписки. По наступлении генерируется событие, которое можно использовать для рассылки, прекращения доступа и т.п.

comm => (string)  не обязательно — текстовый комментарий

promocode => (string) не обязательно —промокод, который использовался при оплате. Если указан промокод, то данные для расчета партнерских вознаграждений будут взяты из промокода, иначе из продукта.

Response: 200 при успешном результате, либо 400 и error + описание ошибки.


--------------


Сохранение реквизитов для перечисления вознаграждения в партнерском кабинете

Нужно при создании кастомного партнерского кабинета, который работает на основе api. 

Endpoint:	POST /partner/details/

Parameters:
uid => (string 32) — uid партнера, полученный ранее при авторизации в кабинете, либо при получении информации о лиде/партнере.
bank_details => (string) — текст. Если нужно разбить по полям, то можно сохранять структуру в формате json
	
Response: 200 при успешном результате, либо 400 и error + описание ошибки.

--------------


Проверка авторизации в партнерском кабинете

Запрос необходим, если вы создаете собственные партнерские кабинеты, данные для отображения в которых получаете запросами к api, в частности запросом получения информации о лиде/партнере (GET /lead/).

Например, адрес партнерского кабинета выглядит так:
https://your_site.ru/cabinet/?u=6424b1b79cad7c4c2c7d84b7ab2718ca

В этом случае вы отправляете запрос с direct_code=’6424b1b79cad7c4c2c7d84b7ab2718ca’ по инструкции ниже.
В ответ получаете ошибку, либо uid партнера, который можете использовать в запросе GET /lead/, который вернет вам текущие данные о партнере, включая взаиморасчеты, которые можно вывести в его партнерском кабинете.

Endpoint:	GET /partner/

Parameters:	
direct_code => (string 32) Уникальный код прямого доступа, который выдается системой при регистрации партнера. Заменяет логин и пароль. Получить direct_code можно в GET /lead, а также можно найти в карточке партнера в CRM, можно также отправить в сообщении из CRM, используя подстановку {{direct_code}}. Значение поменяется при смене пароля партнером из CRM.

Либо можно проверить авторизацию используя пару login — passw. В этом случае direct_code не указывается
login => (string 32)  Логин пользователя в CRM WinWinLand

passw => (string 32) Пароль пользователя в CRM WinWinLand.

Response: 200 при успешном результате + json структура, содержащая  uid и access_level — уровень доступа (3-админ, 4 — менеджер, 5 — партнер). 
Либо 400 и error + описание ошибки (если данные авторизации не верные).

-------------------

       Отправка уведомления
Запрос отправляет уведомление по указанному лиду в служебный бот

Endpoint:	POST /lead/notify

Parameters:	
uid => (string 32, int)uid лида
msg => (string)  текст сообщения

Response: 200 при успешном результате + json вида ['success'=>'mesage sent to: '+uid]
400 при ошибке отправки
Для успешной отправки должен быть настроен служебный бот в CRM WinWinLand

---------------------


Расчет вознаграждения партнеру

Запрос производит учет последних платежей рефералов и рассчитывает вознаграждение партнеру, которое становится видимым в отчетах и партнерском кабинете.

Endpoint:	GET /lead/fee

Parameters:	
client_uid => (string 32, int) uid партнера — не обязательно

client_phone => (numbers only) — не обязательно

client_email => (string in email format) — не обязательно

telegram_id => (int) — не обязательно

telegram_nic => (string) — не обязательно

vk_id => (int) — не обязательно

Должен быть указан хотя бы один параметр. Производится поиск партнера в базе по переданным параметрам в порядке перечисления в в статье.
Если лид найден и это партнер, то выполняется проводка вознаграждения ему в системе.

Response: 200 при успешном результате + json вида 
['uid' => UID, 'rest_fee' => остаток_вознаграждения_к_выплате, [count] =>       Описание API
API WinWinLand позволяет работать с данными платформы, используя HTTP-запросы. При помощи API можно получать, добавлять, изменять и удалять информацию о различных объектах. Функционал API позволяет интегрировать различные внешние сервисы, обеспечить синхронизацию данных, а также получить все данные для создания кастомного партнерского кабинета в  WinWinLand.

       Ограничения
На платформе присутствует ограничение в 500 запросов к API в течение 5 минут.

Время рассчитывается с момента первого запроса в серии. Количество выполненных запросов в текущем промежутке времени передается в HTTP-заголовке API-Usage-Limit (например, API-Usage-Limit: 1/500).

При достижении лимита доступ к API ограничивается до окончания текущих 5 минут. При этом в HTTP-заголовке Retry-After передается время в секундах до восстановления доступа.

       Авторизация
Для авторизации необходимо указать
1. Номер аккаунта (client_id) — зайти в CRM, Настройки-Профиль и раскрыть иконку рядом с заголовком «Профиль». Это число, например 12345
2. Secret (client_secret) — скопировать из Настройки — Профиль - Настройка интеграций по API и вебхук

В каждом запросе вам необходимо передавать в заголовке данные Basic авторизации:
Authorization: Basic  base64_encode("client_id:client_secret")
В случае ошибки авторизации возвращается код 401 и ответ в формате JSON вида ['error' => 'Unauthorized: error description']

       Общие принципы
API WinWinLand принимает POST, GET, PUT и DELETE-запросы в зависимости от выполняемого действия. Тип и адрес запроса для требуемого действия можно найти на api.winwinland.ru.

Текст самого запроса должен соответствовать формату JSON. Значение HTTP-заголовка Content-Type: application/json

Пример GET запроса на PHP на получение информации о лиде/партнере. Запрос находит лида с email :'mail@gmail.com' и выводит информацию о нем.

$client_id='12345';
$client_secret='ec8ce6abb3e952a85b8551ba726a1555';
$data=['client_email'=>'mail@gmail.com'];
$url="https://api.winwinland.ru/lead/";

$ch = curl_init();

// Устанавливаем параметры запроса
$data = http_build_query($data);
curl_setopt($ch, CURLOPT_URL, $url.'?'.$data);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_HTTPHEADER, [
        'Authorization: Basic ' . base64_encode("$client_id:$client_secret") // Кодируем учетные данные в формате Base64
    ]);
// Выполняем запрос
$response = curl_exec($ch);
curl_close($ch);
// Проверяем на ошибки
if ($response === false) {
	echo 'cURL Error: ' . curl_error($ch);
} else {
        // Обрабатываем ответ
	$res = json_decode($response, true);
	print_r($res); // Печатаем полученные данные
}

       Ответы сервера
200 OK — Штатный ответ, указывающий на успешное выполнение запроса.
201 Created — Может возвращаться при создании новых объектов, также означает успешную операцию.
400 Bad Request — Некорректный HTTP-запрос, сервер не смог его обработать (например, слишком большой заголовок).
401 Unauthorized — Ошибка авторизации; необходимо проверить данные для Basic-авторизации приложения.
403 Forbidden — Нет прав для выполнения данной операции; проверьте настройки прав доступа для вашего приложения.
404 Not Found — Запрошенный объект не найден, возможно, его удалили или ID указан ошибочно.
429 Too Many Requests — Превышены лимиты на API-запросы; если лимитов не хватает, стоит обратиться в поддержку.
500 Internal Server Error — Внутренняя ошибка сервераnsales; возможно, проблема в некорректном формировании данных в запросе.
504 Gateway Timeout — Сервер не успел обработать запрос за установленное время (50 секунд); может быть вызвано слишком большим объемом запрашиваемых данных. 
       Вызовы API
Ссылка на раздел с вызовами API

Получение информации о лиде/партнере. 
При запросе происходит поиск лида по одному из параметров (указаны в порядке приоритета поиска). При успешном поиске возвращается массив с данными о лиде/партнере.

Endpoint:	GET /lead/

Parameters:	
client_uid => (numbers only)  ID контакта в CRM WinWinLand, может быть отрицательное значение.
client_phone => (numbers only)  нужно для подстановки в secret. Если не указан client_uid, то производится поиск по номеру телефона. Будет выдан первый найденный контакт с этим номером.
client_email => Если не указан или не был найден контакт ни по client_uid, ни по client_phone, то производится поиск по email. Будет выдан первый найденный контакт с этим email.
client_tg => Поиск по telegram_id
client_vk => Поиск по vkontakte_id
order => (string). — не обязательно. Номер заказа. Если передано, то к результату будут добавлены данные по этому заказу, если он существует и относится к этому контакту

Response: 200, json
Структура данных, возвращаемых при успешном поиске:
Array
(
    [secret] => не используется
    [action] => не используется
    [uid] => Уникальный идентификатор (client_uid) карточки в CRM WinWinLand
    [first_name] => Имя 
    [last_name] => Фамилия 
    [phone] => Номер телефона 
    [email] => Электронная почта 
    [city] => Город 
    [telegram_id] => ID  в Telegram
    [telegram_nic] => Никнейм  в Telegram
    [vk_id] => ID ВКонтакте
    [tm] => Временная метка (timestamp) создания записи
    [comm] => Комментарий в карточке 
    [partner_id] =>  ID вышестоящего партнёра (если 0, значит, пользователь не привязан к партнеру)
    [is_partner] => Флаг, указывающий, что это партнёр
    [partner_code] => Партнёрский код пользователя (если партнер)
    [cabinet_link] => ссылка на партнерский кабинет (если партнер)
    [direct_code] => код для прямого доступа в партнерский кабинет. По этому коду партнер логинится в системе.
    [bank_details] => реквизиты для выплаты вознаграждения, указанные в личном кабинете
    [partner_data] => Array //Массив данных по партнеру (если партнер). Информация та же, что и в партнерском кабинете.
        (
            [cnt_reg_year] => Количество регистраций за год
            [sum_buy_year] => Сумма покупок за год
            [sum_fee_year] => Сумма комиссий за год
            [sum_pay_year] => Сумма выплат за год
            [cnt_reg_this_month] => Регистрации в текущем месяце
            [sum_buy_this_month] => Покупки в текущем месяце
            [sum_fee_this_month] => Комиссии в текущем месяце
            [sum_pay_this_month] => Выплаты в текущем месяце
            [cnt_reg_last_month] => Регистрации в прошлом месяце
            [sum_buy_last_month] => Покупки в прошлом месяце
            [sum_fee_last_month] => Комиссии в прошлом месяце
            [sum_pay_last_month] => Выплаты в прошлом месяце
            [cnt_reg_this_week] => Регистрации на текущей неделе
            [sum_buy_this_week] => Покупки на текущей неделе
            [sum_fee_this_week] => Комиссии на текущей неделе
            [sum_pay_this_week] => Выплаты на текущей неделе
            [cnt_reg_yesterday] => Регистрации за вчера
            [sum_buy_yesterday] => Покупки за вчера
            [sum_fee_yesterday] => Комиссии за вчера
            [sum_pay_yesterday] => Выплаты за вчера
            [cnt_reg_today] => Регистрации за сегодня
            [sum_buy_today] => Покупки за сегодня
            [sum_fee_today] => Комиссии за сегодня
            [sum_pay_today] => Выплаты за сегодня
            [sum_fee_all] => Общая сумма комиссий за всё время
            [sum_pay_all] => Общая сумма выплат за всё время
            [rest_all] => Остаток средств (разница между комиссиями и выплатами)
        )


[current_order] => Array //массив данных по текущему оплаченному заказу (присутствует только, если вебхук был отправлен по событию "Покупка" или "Оплата")
[fee_detailed] =>array //начисления партнеру по операциям
  (
    [client_uid] => uid клиента, по продаже которому начислены комиссионные
    [tm] => время операции (unix timestamp)
    [first_name] => имя клиента
    [last_name] => фамилия клиента
    [order_number] => номер заказа
    [order_descr] => продукт
    [sum] => сумма заказа
    [fee_percent] => вознагр в %
    [fee_sum] => сумма начисленного вознаграждения
    [level] => уровень в партнерской программе (1 - собственная продажа)
    [partner_uid] => uid партнера, по продаже которого было начислено вознаграждение (либо собственная продажа)
    [partner_name] => имя партнера, по продаже которого было начислено вознаграждение (либо собственная продажа)
    [comm] => комментарий к операции, если был указан при ручном начислении
  )
[fee_paid] => Array  //выплаты партнеру по операциям
                (
                    [tm] => время операции, timestamp
                    [sum_pay] => сумма оплаты
                    [vid] => Вид платежа. 1 - деньги, ... 
                    [comm] => комментарий к платежу
                )
[fee_orders] => Array //Заказы от рефералов
              (
  [tm]=> (timestamp) время заказа 
                [referal_uid] => uid реферала
  [referal_name]=>  имя реферала
  [sum]=> сумма заказа
  [paid]=> оплачен заказ или нет (1 или 0)
             )            ];
    (
		[tm] => Временная метка заказа
        [pay_system] => Платёжная система
        [sku] => Артикул товара
        [order_id] => ID заказа
        [order_number] => Номер заказа 
        [client_name] => Имя клиента (указанное при на заполнении платежной формы) 
        [phone] => Телефон клиента (указанное при на заполнении платежной формы) 
        [email] => Почта клиента (указанное при на заполнении платежной формы) 
        [uid] => ID клиента
        [res] => Результат операции (1 — успешно)
        [currency] => Валюта (0 — рубли)
        [land_num] => Номер платежного лендинга
        [comm] => Комментарий к заказу
        [products] => Array //массив продуктов в составе заказа
            (
                [0] => Array
                    (
                        [product_id] => ID товара (соответствует номеру в справочнике продуктов)
                        [product_descr] => Наименование товара
                        [amount] => Стоимость товара
                        [tm_end] => Время окончания доступа (если 0 - то ограничения нет)
                        [fee_1] => Комиссия партнёра уровня 1 (значение заполнено, если при оплате был применен партнерский промокод, данные берутся из промокода. Если значение здесь указано,то данные для расчета комиссии будут браться отсюда, если нет,то будет взято значение из индивидуальных настроек для партнера,если и там нет - то из справочника продуктов.
                        [fee_2] => Комиссия партнёра уровня 2 (алгоритм то же)
                    )

            )

        [sum] => Общая сумма заказа
    )

[promocodes] => Array //массив партнерских промокодов, доступных для использования (должен быть партнером)
    (
        [0] => Array
            (
                [id] => ID промокода
                [tm1] => Начало действия
                [tm2] => Окончание действия
                [uid] => ID владельца промокода
                [product_id] => Номер товара в системе, для которого действует промокод
                [product_descr] => Наименование продукта
                [discount] => Скидка. Если значение <100 , то считается, что это %, 100 и больше - считается в рублях
                [price] => Фиксированная цена (если discount=0) (если обы значения 0 - то промокод дает нулевую цену)
                [promocode] => Сам промокод
                [fee_1] => Комиссия 1-го уровня для владельца (<100 - проценты, 100 и больше - рубли)
                [fee_2] => Комиссия 2-го уровня для владельца
                [cnt] => Ограничение на количество использований (-1 - без ограничений по количеству)
            )
)


--------------


Добавление лида/партнера 
Запрос добавляет лида/партнера в  CRM WinWinLand

Endpoint:	POST /lead/

Parameters:	
bc => (int) партнерский код — не обязательно. Партнерский код вышестоящего партнера, за которым лид будет закреплен.

land_num => (int) номер лэндинга. Несмотря на то, что запрос отправляется из сторонней системы, в Винвинлэнд должен быть создан лэндинг (который не требуется оформлять), но из него будут подтягиваться время события, этап и тэг, если указаны. Также возможно настраивать триггерные рассылки по событиям регистраций на этом лэндинге. Если лэндинг не указан, то используется лэндинг номер 1.

Если client_phone или client_email найден в CRM, то зафиксируется событие регистрации, но новой записи создаваться не будет

client_name => (string) — обязательно. Если лид уже есть в CRM, то имя затронуто не будет.
last_name => (string) — не обязательно. Если лид уже есть в CRM, то изменения будут записаны, только если в существующей записи этот параметр отсутствует.
То же касается и всех не обязательных параметров ниже.

client_phone => (numbers only) — не обязательно

client_email => (string in email format) — не обязательно

telegram_id => (int) — не обязательно

telegram_nic => (string) — не обязательно

vk_id => (int) — не обязательно

city => (string) — не обязательно

comm => (string) — не обязательно — текстовый комментарий

make_partner => 1 или 0 — не обязательно, по умолчанию 0. Сделать партнером. Если лид уже зарегистрирован, как партнер, то ничего не происходит. Если лид уже существует в базе, то он будет сделан партнером.

make_partner_code => (string) — не обязательно, партнерский код для вновь созданного или существующего партнера (в этом случае старый код будет заменен. Учтите, что в этом случае ранее созданные ссылки работать не будут). Работает только при make_partner=1,если make_partner_code не задано или 0 — то создастся автоматически числовой партнерский код.

utm метки (string) вы можете передать также любые стандартные utm метки, они привяжутся к событию регистрации и можно будет видеть в карточке в CRM и в отчетах. Так, например, можно будет отследить оплаты по utm меткам.

Response: 200 при успешном результате, либо 400 и error + описание ошибки.

--------------------

Добавление события оплаты

Запрос добавляет информацию об оплате в CRM WinWinLand вмести с данными о клиенте. Далее  WinWinLand использует информацию о партнере, за которым закреплен клиент, и рассчитывает вознаграждение, на основе сохраненных условий, на всех партнерских уровнях.

Endpoint:	POST /pay/

Parameters:	
bc => (int) партнерский код — не обязательно. Партнерский код вышестоящего партнера, за которым лид будет закреплен, если его нет в базе, либо если он ни за кем не закреплен.

Производится поиск по client_uid, client_email, client_phone (с учетом приоритета, как перечислено). Если клиент найден, то оплата присваивается ему, если нет, то создается новый лид, без партнерского статуса, и к нему привязывается событие оплаты. В случае создания лид прикрепляется к партнеру, которому принадлежит партнесркий код bc.

land_num => (int) номер лэндинга. Несмотря на то, что запрос отправляется из сторонней системы, в Винвинлэнд должен быть создан лэндинг (который не требуется оформлять), но из него будут подтягиваться время события, этап и тэг, если указаны. Также возможно настраивать триггерные рассылки по событиям регистраций на этом лэндинге. Если лэндинг не указан, то используется лэндинг номер 1.

client_name => (string) — Должно быть

client_uid => (string, может быть отрицательным) —  не обязательно

client_phone => (numbers only) — не обязательно

client_email => (string in email format) — не обязательно
Один из трех параметров, перечисленных выше, должен быть обязательно, для идентификации в CRM

sku => (varchar 32) — не обязательно

order_number => (varchar 32) — не пустое значение — номер заказа. Если заказ с таким номером уже существует, то вызов вернет ошибку

product_id => (int) — обязательно. Важно! Предварительно в WinWinLand в справочнике продуктов (Настройки-продукты) должен существовать продукт с таким же номером (ID) .

product_descr => (string) —  обязательно. Название продукта

pay_system => (string) — не обязательно — платежная система, информационно, для отчетов. По умолчанию ‘api’

payed_money => (string) — сумма платежа. Возможен цифровой формат, либо 123 руб и т.п. Будет преобразовано к числу.

payed_at => (unix timestamp) не обязательно —Время платежа. По умолчанию текущее время.

payed_end => (unix timestamp) не обязательно —Время окончания подписки. По наступлении генерируется событие, которое можно использовать для рассылки, прекращения доступа и т.п.

comm => (string)  не обязательно — текстовый комментарий

promocode => (string) не обязательно —промокод, который использовался при оплате. Если указан промокод, то данные для расчета партнерских вознаграждений будут взяты из промокода, иначе из продукта.

Response: 200 при успешном результате, либо 400 и error + описание ошибки.


--------------


Сохранение реквизитов для перечисления вознаграждения в партнерском кабинете

Нужно при создании кастомного партнерского кабинета, который работает на основе api. 

Endpoint:	POST /partner/details/

Parameters:
uid => (string 32) — uid партнера, полученный ранее при авторизации в кабинете, либо при получении информации о лиде/партнере.
bank_details => (string) — текст. Если нужно разбить по полям, то можно сохранять структуру в формате json
	
Response: 200 при успешном результате, либо 400 и error + описание ошибки.

--------------


Проверка авторизации в партнерском кабинете

Запрос необходим, если вы создаете собственные партнерские кабинеты, данные для отображения в которых получаете запросами к api, в частности запросом получения информации о лиде/партнере (GET /lead/).

Например, адрес партнерского кабинета выглядит так:
https://your_site.ru/cabinet/?u=6424b1b79cad7c4c2c7d84b7ab2718ca

В этом случае вы отправляете запрос с direct_code=’6424b1b79cad7c4c2c7d84b7ab2718ca’ по инструкции ниже.
В ответ получаете ошибку, либо uid партнера, который можете использовать в запросе GET /lead/, который вернет вам текущие данные о партнере, включая взаиморасчеты, которые можно вывести в его партнерском кабинете.

Endpoint:	GET /partner/

Parameters:	
direct_code => (string 32) Уникальный код прямого доступа, который выдается системой при регистрации партнера. Заменяет логин и пароль. Получить direct_code можно в GET /lead, а также можно найти в карточке партнера в CRM, можно также отправить в сообщении из CRM, используя подстановку {{direct_code}}. Значение поменяется при смене пароля партнером из CRM.

Либо можно проверить авторизацию используя пару login — passw. В этом случае direct_code не указывается
login => (string 32)  Логин пользователя в CRM WinWinLand

passw => (string 32) Пароль пользователя в CRM WinWinLand.

Response: 200 при успешном результате + json структура, содержащая  uid и access_level — уровень доступа (3-админ, 4 — менеджер, 5 — партнер). 
Либо 400 и error + описание ошибки (если данные авторизации не верные).

-------------------

       Отправка уведомления
Запрос отправляет уведомление по указанному лиду в служебный бот

Endpoint:	POST /lead/notify

Parameters:	
uid => (string 32, int)uid лида
msg => (string)  текст сообщения

Response: 200 при успешном результате + json вида ['success'=>'mesage sent to: '+uid]
400 при ошибке отправки
Для успешной отправки должен быть настроен служебный бот в CRM WinWinLand

---------------------


       Расчет вознаграждения партнеру
Запрос производит учет последних платежей рефералов и рассчитывает вознаграждение партнеру, которое становится видимым в отчетах и партнерском кабинете.

Endpoint:	GET /lead/fee

Parameters:	
client_uid => (string 32, int) uid партнера — не обязательно

client_phone => (numbers only) — не обязательно

client_email => (string in email format) — не обязательно

telegram_id => (int) — не обязательно

vk_id => (int) — не обязательно

Должен быть указан хотя бы один параметр. Производится поиск партнера в базе по переданным параметрам в порядке перечисления в в статье.
Если лид найден и это партнер, то выполняется проводка вознаграждения ему в системе.

Response: 200 при успешном результате + json вида 
['uid' => UID, 'rest_fee' => остаток_вознаграждения_к_выплате, 'count' => количество_учтенных_при_запросе_операций_оплаты ]
400 при ошибке отправки

-------------------------------



       Выплата вознаграждения партнеру
Запрос делает проводку выплаты вознаграждения партнеру, которая фиксируется в отчетах и партнерском кабинете.
Остаток к выплате уменьшается на эту сумму

Endpoint:	POST /lead/fee

Parameters:	
client_uid => (string 32, int) uid партнера — обязательно!
sum => (int) — обязательно, сумма к выплате.
vid => (int) — не обязательно, по умолчанию 0. Вид выплаты, например 0- деньгами, 1- услугами и т.п. Информативно.
comm => (string) - не обязательно, комментарий, отображается в отчетах и детализациях

Response: 200 при успешном результате + json вида 
['uid' => UID, 'rest_fee' => остаток_вознаграждения_к_выплате, 'sum' => сумма]
400 при ошибке отправки


